;===========================================================================
;
; ############################ Definições ############################
;
;===========================================================================

  ; A quantidade de setores configurados aqui deve ser igual ao do BPB meno 1
  STAGE1_SECTORS  equ 1       ; max 0x38 (56)


























;===========================================================================
;
; ############################ Código ############################
;
;===========================================================================

SECTION .text
[ORG 0x0]
[BITS 16]
[CPU 8086]

Start:
  ; ### Ajustes iniciais ###
  ; Garante que os segmentos sejam iguais a CS

  mov   ax, cs
  mov   ds, ax
  mov   es, ax

  mov   ax, BOOT_MSG
  call  WriteAStr































  mov   ax, TEST_MSG
  call  WriteAStr
  call  Halt



;===========================================================================
;
; ############################ Procedimentos ############################
;
;===========================================================================



;===========================================================================
; Error
; --------------------------------------------------------------------------
; Mostra mensagem de erro e poe em modo halt
;===========================================================================

Error:
  mov   ax, ERROR_MSG
  call  WriteAStr

;===========================================================================
; Halt
; --------------------------------------------------------------------------
; Mantem execucao parada ate que seja resetado
;===========================================================================

Halt:
  hlt
  jmp   Halt

  %include "writeastr-inc.asm"



























;===========================================================================
;
; ############################ DATA ############################
;
;===========================================================================

  BOOT_MSG          db  '* STAGE_1:', 10, 13, 0
  ERROR_MSG         db  'Falha no stage1!', 0






























  TEST_MSG          db  'Chegou ate aqui!', 10, 13, 0



;===========================================================================
;
; ############################ Assinatura de boot ############################
;
; --------------------------------------------------------------------------
; Evita que a BSS seja sobreescrita pela carga do EBS
  times ((0x200 * STAGE1_SECTORS) - 8) - ($ - $$) db 0
  db 'LOS-BOOT'
;===========================================================================



;===========================================================================
;
; ############################ BSS ############################
;
;===========================================================================
